composer require laravel/ui
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import axios from 'axios';
import Header from '../components/Header';
import Footer from '../components/Footer';
import HeaderLink from '../components/HeaderLink';
import ArticleCard from '../components/ArticleCard';
import logo from '../assets/images/logo.svg';

export default function Search() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const navigate = useNavigate();

  useEffect(() => {
    if (query.trim().length > 2) {
      const searchArticles = async () => {
        setLoading(true);
        setError(null);
        try {
          const response = await axios.get('/api/articles/search', {
            params: { q: query }
          });
          setResults(response.data.data || []);
        } catch (err) {
          console.error('Error searching articles:', err);
          setError('Failed to search articles. Please try again.');
          setResults([]);
        } finally {
          setLoading(false);
        }
      };

      const debounceTimer = setTimeout(searchArticles, 300);
      return () => clearTimeout(debounceTimer);
    } else {
      setResults([]);
      setLoading(false);
      setError(null);
    }
  }, [query]);

  return (
    <div className="flex flex-col min-h-screen">
      <Header />
      <HeaderLink />

      <main className="container mx-auto grow">
        <div className="bg-search-bg bg-cover bg-center h-20" style={{
          backgroundImage: `linear-gradient(to right, #2a5a82 20%, rgba(42,90,130,0.2)), url('/src/assets/images/bg.jpg' )`
        }}>
          <h1 className="text-5xl font-bold text-white justify-center flex items-center h-full md-8">SEARCH</h1>
        </div>

        <div className="mb-6 mt-8">
          <input
            type="text"
            placeholder="Search for articles..."
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
            autoFocus
          />
        </div>

        {loading ? (
          <div className="text-center text-gray-500 py-8">Searching...</div>
        ) : error ? (
          <div className="text-center text-red-600 py-8">{error}</div>
        ) : results.length > 0 ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            {results.map((article) => (
              <ArticleCard
                key={article.id}
                article={{
                  imageUrl: article.featured_image || 'https://via.placeholder.com/300x200?text=No+Image',
                  title: article.title,
                  snippet: article.excerpt,
                  category: article.categories && article.categories.length > 0 ? article.categories[0].name : 'Uncategorized',
                  author: article.author && article.author.user ? article.author.user.name : 'Unknown Author',
                  date: new Date(article.published_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  })
                }}
                onClick={() => navigate(`/article/${article.slug}`)}
              />
            ))}
          </div>
        ) : query.trim().length > 2 ? (
          <section className="text-center text-gray-500 justify-center py-5 mt-20">
            <div className="flex justify-center mb-4">
              <img src={logo} alt="La Verdad Herald Logo" />
            </div>
            <h1 className="text-3xl font-bold text-gray-800 mb-4">
              No articles found for "{query}"</h1>
            Try adjusting your search terms.
          </section>
        ) : (
          <section className="text-center text-gray-500 justify-center py-5 mt-20">
            <div className="flex justify-center mb-4">
              <img src={logo} alt="La Verdad Herald Logo" />
            </div>
            <h1 className="text-3xl font-bold text-gray-800 mb-4">
              Start Searching</h1>
            Enter keywords to find articles.
          </section>
        )}
      </main>

      <Footer />
    </div>
  );
}


